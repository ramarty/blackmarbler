[{"path":"https://ramarty.github.io/blackmarbler/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2023 Robert Marty Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://ramarty.github.io/blackmarbler/articles/blackmarbler-vignette.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"Black Marble Nighttime Lights","text":"fill .","code":""},{"path":"https://ramarty.github.io/blackmarbler/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Robert Marty. Author, maintainer.","code":""},{"path":"https://ramarty.github.io/blackmarbler/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Marty R (2023). blackmarbler: Black Marble R. R package version 0.1.0, https://ramarty.github.io/blackmarbler/.","code":"@Manual{,   title = {blackmarbler: Black Marble R},   author = {Robert Marty},   year = {2023},   note = {R package version 0.1.0},   url = {https://ramarty.github.io/blackmarbler/}, }"},{"path":"https://ramarty.github.io/blackmarbler/index.html","id":"blackmarbler-","dir":"","previous_headings":"","what":"Black Marble R","title":"Black Marble R","text":"Create Georeferenced Rasters Nighttime Lights NASA Black Marble data. Overview Installation Bearer token bm_raster() function Make raster Make raster stack across multiple time periods Make map Make figure trends nighttime lights","code":""},{"path":"https://ramarty.github.io/blackmarbler/index.html","id":"overview-","dir":"","previous_headings":"","what":"Overview","title":"Black Marble R","text":"package facilitates downloading nighttime lights Black Marble data. Black Marble data downloaded NASA LAADS Archive. package automates process downloading relevant tiles NASA LAADS archive cover region interest, converting raw files (H5 format) georeferenced rasters, mosaicing rasters together needed.","code":""},{"path":"https://ramarty.github.io/blackmarbler/index.html","id":"installation-","dir":"","previous_headings":"","what":"Installation","title":"Black Marble R","text":"package can installed via devtools.","code":"# install.packages(\"devtools\") devtools::install_github(\"ramarty/blackmarbler\")"},{"path":"https://ramarty.github.io/blackmarbler/index.html","id":"bearer-token-","dir":"","previous_headings":"","what":"Bearer Token","title":"Black Marble R","text":"function requires using Bearer Token; obtain token, follow steps: Go NASA LAADS Archive Click “Login” (bottom top right); create account needed. Click “See wget Download Command” (bottom near top, middle) clicking, see text can used download data. “Bearer” token long string red.","code":""},{"path":[]},{"path":"https://ramarty.github.io/blackmarbler/index.html","id":"bm_raster-function-","dir":"","previous_headings":"Quickstart","what":"bm_raster() Function","title":"Black Marble R","text":"primary function package bm_raster, produces raster black marble nighttime lights. can produce rasters following Black Marble products: function takes following arguments: roi_sf: Region interest; sf polygon. Must WGS 84 (epsg:4326) coordinate reference system. product_id: One following: \"VNP46A1\": Daily (raw) \"VNP46A2\": Daily (corrected) \"VNP46A3\": Monthly \"VNP46A4\": Annual date: Date raster data. Entering one date produce raster. Entering multiple dates produce raster stack. product_ids \"VNP46A1\" \"VNP46A2\", date (eg, \"2021-10-03\"). product_id \"VNP46A3\", date year-month (e.g., \"2021-10-01\", day ignored, \"2021-10\"). product_id \"VNP46A4\", year date (e.g., \"2021-10-01\", month day ignored, 2021). bearer NASA bearer token. instructions create token, see . variable: Variable used create raster (default: NULL). information variable choices, see ; VNP46A1, see Table 3; VNP46A2 see Table 6; VNP46A3 VNP46A4, see Table 9. NULL, uses following default variables: product_id :VNP46A1\", uses DNB_At_Sensor_Radiance_500m. product_id \"VNP46A2\", uses Gap_Filled_DNB_BRDF-Corrected_NTL. product_ids \"VNP46A3\" \"VNP46A4\", uses NearNadir_Composite_Snow_Free.","code":""},{"path":"https://ramarty.github.io/blackmarbler/index.html","id":"make-raster-of-nighttime-lights-","dir":"","previous_headings":"Quickstart","what":"Make raster of nighttime lights","title":"Black Marble R","text":"example shows making daily, monthly, annual rasters nighttime lights Ghana.","code":"#### Setup # Load packages library(blackmarbler) library(geodata) library(sf)  # Define NASA bearer token bearer <- \"BEARER-TOKEN-HERE\"  # Define region of interest (roi). The roi must be (1) an sf polygon and (2) # in the WGS84 (epsg:4326) coordinate reference system. Here, we use the  # getData function to load a polygon of Ghana roi_sf <- gadm(country = \"GHA\", level=0, path = tempdir()) %>% st_as_sf()  #### Make Rasters ### Daily data: raster for February 5, 2021 r_20210205 <- bm_raster(roi_sf = roi_sf,                         product_id = \"VNP46A2\",                         date = \"2021-02-05\",                         bearer = bearer)    ### Monthly data: raster for October 2021 r_202110 <- bm_raster(roi_sf = roi_sf,                       product_id = \"VNP46A3\",                       date = \"2021-10-01\", # The day is ignored                       bearer = bearer)  ### Annual data: raster for 2021 r_2021 <- bm_raster(roi_sf = roi_sf,                     product_id = \"VNP46A4\",                     date = 2021,                     bearer = bearer)"},{"path":"https://ramarty.github.io/blackmarbler/index.html","id":"make-raster-stack-of-nighttime-lights-across-multiple-time-periods-","dir":"","previous_headings":"Quickstart","what":"Make raster stack of nighttime lights across multiple time periods","title":"Black Marble R","text":"extract data multiple time periods, add multiple time periods date. function return raster stack, raster band corresponds different date. code provides examples getting data across multiple days, months, years.","code":"#### Daily data in March 2021 r_daily <- bm_raster(roi_sf = roi_sf,                      product_id = \"VNP46A3\",                      date = seq.Date(from = ymd(\"2021-03-01\"), to = ymd(\"2021-03-31\"), by = \"day\"),                      bearer = bearer)                            #### Monthly aggregated data in 2021 and 2022 r_monthly <- bm_raster(roi_sf = roi_sf,                        product_id = \"VNP46A3\",                        date = seq.Date(from = ymd(\"2021-01-01\"), to = ymd(\"2022-12-01\"), by = \"month\"),                        bearer = bearer)                            #### Yearly aggregated data in 2012 and 2021 r_annual <- bm_raster(roi_sf = roi_sf,                       product_id = \"VNP46A4\",                       date = 2012:2021,                       bearer = bearer)"},{"path":"https://ramarty.github.io/blackmarbler/index.html","id":"map-of-nighttime-lights-","dir":"","previous_headings":"Quickstart","what":"Map of nighttime lights","title":"Black Marble R","text":"Using one rasters, can make map nighttime lights","code":"#### Packages # Need ggplot for mapping library(ggplot2)  #### Prep data r_2021 <- r_2021 %>% mask(roi_sf)   r_df <- rasterToPoints(r_2021, spatial = TRUE) %>% as.data.frame() names(r_df) <- c(\"value\", \"x\", \"y\")  ## Remove very low values of NTL; can be considered noise  r_df$value[r_df$value <= 2] <- 0  ## Distribution is skewed, so log r_df$value_adj <- log(r_df$value+1)  ##### Map  p <- ggplot() +   geom_raster(data = r_df,                aes(x = x, y = y,                    fill = value_adj)) +   scale_fill_gradient2(low = \"black\",                        mid = \"yellow\",                        high = \"red\",                        midpoint = 4.5) +   labs(title = \"NTL, October 2021\") +   coord_quickmap() +    theme_void() +   theme(plot.title = element_text(face = \"bold\", hjust = 0.5),         legend.position = \"none\")"},{"path":"https://ramarty.github.io/blackmarbler/index.html","id":"trends-over-time-","dir":"","previous_headings":"Quickstart","what":"Trends over time","title":"Black Marble R","text":"can use multiple rasters time observe changes nighttime lights time. code leverages exactextractr package summarize annual nighttime lights Ghana’s first administrative division.","code":"#### Packages # Rely on exactextractr to summarize nighttime lights within admin zones and ggplot for the figure. library(exactextractr) library(ggplot2)  #### ADM 1 polygons for Ghana # Load both country and admin 1 level. Country-level is needed as bm_raster() requires # a polygon that is just one row. gha_1_sf <- gadm(country = \"GHA\", level=1, path = tempdir()) %>% st_as_sf()  #### Extract annual data r <- bm_raster(roi_sf = gha_0_sf,                product_id = \"VNP46A4\",                date = 2012:2022,                bearer = bearer)  ntl_df <- exact_extract(r_annual, gha_1_sf, 'mean', progress = FALSE) ntl_df$NAME_1 <- gha_1_sf$NAME_1  #### Trends over time ntl_df %>%   pivot_longer(cols = -NAME_1) %>%   mutate(year = name %>% str_replace_all(\"mean.t\", \"\") %>% as.numeric()) %>%   ggplot() +   geom_col(aes(x = year,                y = value),            fill = \"darkorange\") +   facet_wrap(~NAME_1) +   labs(x = NULL,        y = \"NTL Luminosity\",        title = \"Ghana Admin Level 1: Annual Average Nighttime Lights\") +   theme_minimal() +   theme(strip.text = element_text(face = \"bold\"))"},{"path":"https://ramarty.github.io/blackmarbler/reference/bm_raster.html","id":null,"dir":"Reference","previous_headings":"","what":"Make Black Marble Raster — bm_raster","title":"Make Black Marble Raster — bm_raster","text":"Make raster nighttime lights NASA Black Marble data","code":""},{"path":"https://ramarty.github.io/blackmarbler/reference/bm_raster.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Make Black Marble Raster — bm_raster","text":"","code":"bm_raster(roi_sf, product_id, date, bearer, variable = NULL)"},{"path":"https://ramarty.github.io/blackmarbler/reference/bm_raster.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Make Black Marble Raster — bm_raster","text":"roi_sf Region interest; sf polygon. Must WGS 84 (epsg:4326) coordinate reference system. product_id One following: \"VNP46A1\": Daily (raw) \"VNP46A2\": Daily (corrected) \"VNP46A3\": Monthly \"VNP46A4\": Annual date Date raster data. Entering one date produce raster. Entering multiple dates produce raster stack. product_ids \"VNP46A1\" \"VNP46A2\", date (eg, \"2021-10-03\"). product_id \"VNP46A3\", date year-month (e.g., \"2021-10-01\", day ignored, \"2021-10\"). product_id \"VNP46A4\", year date  (e.g., \"2021-10-01\", month day ignored, 2021). bearer NASA bearer token. instructions create token, see . variable Variable used create raster (default: NULL). NULL, uses following default variables: product_id :VNP46A1\", uses DNB_At_Sensor_Radiance_500m. product_id \"VNP46A2\", uses Gap_Filled_DNB_BRDF-Corrected_NTL. product_ids \"VNP46A3\" \"VNP46A4\", uses NearNadir_Composite_Snow_Free. information variable choices, see ; VNP46A1, see Table 3; VNP46A2 see Table 6; VNP46A3 VNP46A4, see Table 9.","code":""},{"path":"https://ramarty.github.io/blackmarbler/reference/bm_raster.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Make Black Marble Raster — bm_raster","text":"Raster","code":""},{"path":"https://ramarty.github.io/blackmarbler/reference/bm_raster.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Make Black Marble Raster — bm_raster","text":"","code":"if (FALSE) { # Define bearer token bearer <- \"BEARER-TOKEN-HERE\"  # sf polygon of Ghana library(geodata) roi_sf <- gadm(country = \"GHA\", level=0, path = tempdir()) %>% st_as_sf()  # Daily data: raster for October 3, 2021 ken_20210205_r <- bm_raster(roi_sf = roi_sf,                             product_id = \"VNP46A2\",                             date = \"2021-10-03\",                             bearer = bearer)  # Monthly data: raster for March 2021 ken_202103_r <- bm_raster(roi_sf = roi_sf,                           product_id = \"VNP46A3\",                           date = \"2021-03-01\",                           bearer = bearer)  # Annual data: raster for 2021 ken_2021_r <- bm_raster(roi_sf = roi_sf,                         product_id = \"VNP46A4\",                         date = 2021,                         bearer = bearer) }"},{"path":"https://ramarty.github.io/blackmarbler/reference/bm_tiles_sf.html","id":null,"dir":"Reference","previous_headings":"","what":"Black Marble Tile Grid Shapefile\nA dataset containing black marble grid tiles. — bm_tiles_sf","title":"Black Marble Tile Grid Shapefile\nA dataset containing black marble grid tiles. — bm_tiles_sf","text":"Black Marble Tile Grid Shapefile dataset containing black marble grid tiles.","code":""},{"path":"https://ramarty.github.io/blackmarbler/reference/bm_tiles_sf.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Black Marble Tile Grid Shapefile\nA dataset containing black marble grid tiles. — bm_tiles_sf","text":"","code":"data(bm_tiles_sf)"},{"path":"https://ramarty.github.io/blackmarbler/reference/bm_tiles_sf.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Black Marble Tile Grid Shapefile\nA dataset containing black marble grid tiles. — bm_tiles_sf","text":"Sf polygon 648 features","code":""},{"path":"https://ramarty.github.io/blackmarbler/reference/bm_tiles_sf.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Black Marble Tile Grid Shapefile\nA dataset containing black marble grid tiles. — bm_tiles_sf","text":"https://blackmarble.gsfc.nasa.gov/","code":""},{"path":"https://ramarty.github.io/blackmarbler/reference/bm_tiles_sf.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"Black Marble Tile Grid Shapefile\nA dataset containing black marble grid tiles. — bm_tiles_sf","text":"Robert Marty rmarty@worldbank.org","code":""}]
